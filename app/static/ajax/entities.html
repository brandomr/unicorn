<div class="row">
    <div id="breadcrumb" class="col-md-12">
        <ol class="breadcrumb">
            <li><a href="index.html">Dashboard</a></li>
            <li><a href="#">Entity Co-occurence Network</a></li>
        </ol>
    </div>
</div>
<div class="well"><a type="button" class="btn btn-default" id="dljs">Export JSON</a><div id="viz-container"></div></div>

<script type="text/javascript">

/*$("#button").click( function()
           {
       
             alert('button clicked');
           }
        );*/
$(document).ready(function() {

    $.get('/viz_latest', function(data){
         $("#viz-container").html('');

     
    graph=JSON.parse(data)
    console.log(graph)
    var network_container = $("#viz-container");
    var width = network_container.parent().width(),
        height = 500;

      var color = d3.scale.category20();

      
      var svg = d3.select("#viz-container").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("pointer-events","all")
        .append('svg:g')
        .call(d3.behavior.zoom().on("zoom",redraw))
        .append('svg:g');

       var force = d3.layout.force()
          .nodes(graph.nodes)
          .links(graph.links)
          .size([width, height])
          .linkDistance(100)
          .charge(-200)
          .start();

        function redraw(){
          svg.attr("transform","translate("
          + d3.event.translate+")"+" scale("+d3.event.scale+")");
        }

        var link = svg.append("g").selectAll(".link")
            .data(graph.links)
          .enter().append("line")
            .attr("class", "link");

      // Create the groups under svg
      var gnodes = svg.selectAll('g.gnode')
        .data(graph.nodes)
        .enter()
        .append('g')
        .classed('gnode', true);

      // Add one circle in each group
      var node = gnodes.append("circle")
        .attr("class", "node")
        .attr("r", 5)
        .attr("fill","cadetblue")
        .on("click",function(d){
          window.open("/view/"+d.origin)
        })
        .call(force.drag);

      var labels = gnodes.append("text")
        .attr("fill","black")
        .text(function(d) { return d.id; });

      force.on("tick", function() {
        // Update the links
        link.attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

        // Translate the groups
        gnodes.attr("transform", function(d) { 
          return 'translate(' + [d.x, d.y] + ')'; 
        });    

      });

   

var data = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(graph.links));
$("#dljs").attr("href", 'data:' + data );
$("#dljs").attr("download","data.json")
 });
});
</script>
